---
import Layout from "./Layout.astro";
import SEO from "../components/SEO.astro";
import StructuredData from "../components/StructuredData.astro";

interface MetaItem {
  label: string;
  datetime?: string;
}

interface Props {
  pageTitle: string;
  title: string;
  description: string;
  lang: string;
  backLink: { href: string; text: string };
  meta?: MetaItem[];
  seoProps?: {
    article?: boolean;
    publishedTime?: string;
    author?: string;
    tags?: string[];
    image?: string;
    imageAlt?: string;
  };
  structuredData?: any;
}

const {
  pageTitle,
  title,
  description,
  lang,
  backLink,
  meta = [],
  seoProps = {},
  structuredData,
} = Astro.props;
---

<Layout>
  <SEO slot="head" title={pageTitle} {description} {lang} {...seoProps} />
  {structuredData && <StructuredData slot="head" schema={structuredData} />}
  <main class="content-detail">
    <article class="container">
      <header class="content-header">
        <a href={backLink.href} class="back-link">{backLink.text}</a>
        <slot name="header-before" />
        <h1>{title}</h1>
        {
          meta.length > 0 && (
            <div class="meta">
              {meta.map((item, index) => (
                <>
                  {item.datetime ? (
                    <time datetime={item.datetime}>{item.label}</time>
                  ) : (
                    <span>{item.label}</span>
                  )}
                  {index < meta.length - 1 && <span class="separator">â€¢</span>}
                </>
              ))}
            </div>
          )
        }
        <slot name="quote" />
        <slot name="header-after" />
      </header>

      <div class="content-body">
        <slot />
      </div>

      <slot name="footer" />
    </article>
  </main>
</Layout>

<style>
  .content-detail {
    padding: var(--spacing-lg) 0;
    min-height: calc(100vh - 400px);
  }

  .container {
    max-width: var(--content-max-width);
    margin: 0 auto;
    padding: 0 var(--spacing-md);
  }

  .content-header {
    margin-bottom: 3rem;
  }

  .back-link {
    display: inline-block;
    color: var(--color-primary);
    text-decoration: none;
    margin-bottom: var(--spacing-md);
    font-weight: 500;
  }

  .back-link:hover {
    text-decoration: underline;
  }

  h1 {
    font-size: 2.5rem;
    line-height: 1.2;
    margin: 0 0 1rem 0;
    color: #333;
  }

  .meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    color: var(--color-gray);
    margin-bottom: 1rem;
  }

  .meta span:not(.separator) {
    font-weight: 500;
  }

  .meta time {
    font-weight: normal;
  }

  .separator {
    color: #ccc;
  }

  .content-body {
    font-size: 1.125rem;
    line-height: 1.8;
    color: #333;
  }

  /* Shared markdown content styles */
  .content-body :global(h1) {
    font-size: 2rem;
    margin: 2.5rem 0 1rem 0;
    color: var(--color-primary);
  }

  .content-body :global(h2) {
    font-size: 1.75rem;
    margin: 2rem 0 1rem 0;
    color: var(--color-primary);
  }

  .content-body :global(h3) {
    font-size: 1.5rem;
    margin: 1.75rem 0 0.75rem 0;
    color: #333;
  }

  .content-body :global(h4) {
    font-size: 1.25rem;
    margin: 1.5rem 0 0.75rem 0;
    color: #333;
  }

  .content-body :global(p) {
    margin: 0 0 1.5rem 0;
  }

  .content-body :global(ul),
  .content-body :global(ol) {
    margin: 0 0 1.5rem 0;
    padding-left: 2rem;
  }

  .content-body :global(li) {
    margin-bottom: 0.5rem;
  }

  .content-body :global(a) {
    color: var(--color-primary);
    text-decoration: underline;
  }

  .content-body :global(a:hover) {
    text-decoration: none;
  }

  .content-body :global(code) {
    background: #f5f5f5;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-size: 0.9em;
    font-family: "Courier New", monospace;
  }

  .content-body :global(pre) {
    background: #2d2d2d;
    color: #f8f8f2;
    padding: 1.5rem;
    border-radius: 8px;
    overflow-x: auto;
    margin: 0 0 1.5rem 0;
  }

  .content-body :global(pre code) {
    background: none;
    padding: 0;
    color: inherit;
  }

  .content-body :global(blockquote) {
    border-left: 4px solid var(--color-primary);
    background: var(--color-blockquote-bg);
    padding: 1.5rem;
    padding-bottom: 0.5rem;
    font-size: 1.25rem;
    margin: 1.5rem 0;
    color: var(--color-gray);
    font-style: italic;
  }

  /* Table wrapper for horizontal scrolling on mobile */
  .content-body :global(table) {
    display: block;
    width: 100%;
    overflow-x: auto;
    border-collapse: collapse;
    margin: 1.5rem 0;
    font-size: 1rem;
    /* Prevent the table from shrinking smaller than its content */
    max-width: fit-content;
  }

  .content-body :global(table thead) {
    background: #f5f5f5;
  }

  .content-body :global(table th),
  .content-body :global(table td) {
    border: 1px solid #ddd;
    padding: 0.75rem;
    text-align: left;
    white-space: nowrap;
  }

  .content-body :global(table th) {
    font-weight: 600;
    color: #333;
  }

  .content-body :global(table tr:hover) {
    background: #f9f9f9;
  }

  :global(.content-body img) {
    max-width: 100%;
    height: auto;
    margin: 2rem 0;
  }

  @media (max-width: 48rem) {
    .content-detail {
      padding: var(--spacing-md) 0;
    }

    h1 {
      font-size: 2rem;
    }

    .content-body {
      font-size: 1rem;
    }

    .content-body :global(h1) {
      font-size: 1.75rem;
    }

    .content-body :global(h2) {
      font-size: 1.5rem;
    }

    .content-body :global(h3) {
      font-size: 1.25rem;
    }
  }
</style>
