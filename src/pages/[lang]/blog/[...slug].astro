---
import { Image } from "astro:assets";
import { render } from "astro:content";
import ContentDetailPage from "../../../layouts/ContentDetailPage.astro";
import { getCollectionStaticPaths } from "../../../lib/paths";
import { useI18n } from "../../../i18n/utils";
import { formatDate } from "../../../lib/formatters";

export async function getStaticPaths() {
  return getCollectionStaticPaths("blog");
}

const { post } = Astro.props;
const { Content } = await render(post);

const { lang, translatePath } = useI18n(Astro.url);

const formattedDate = formatDate(post.data.pubDate);

const title = `${post.data.title} | Blog`;
const description =
  post.data.description || `Read ${post.data.title} by ${post.data.author}`;
const canonicalUrl = new URL(Astro.url.pathname, Astro.site).toString();
---

<ContentDetailPage
  pageTitle={title}
  title={post.data.title}
  {description}
  {lang}
  backLink={{ href: translatePath("/blog"), text: "â† Back to Blog" }}
  meta={[
    { label: post.data.author },
    { label: formattedDate, datetime: post.data.pubDate.toISOString() },
  ]}
  seoProps={{
    article: true,
    publishedTime: post.data.pubDate.toISOString(),
    author: post.data.author,
    tags: post.data.tags,
    image: post.data.image?.src,
    imageAlt: post.data.title,
  }}
  structuredData={{
    type: "BlogPosting",
    headline: post.data.title,
    description: description,
    datePublished: post.data.pubDate.toISOString(),
    author: post.data.author,
    tags: post.data.tags,
    url: canonicalUrl,
    image: post.data.image?.src,
  }}
>
  {
    post.data.image && (
      <div slot="header-after" class="header-image">
        <Image src={post.data.image} alt={post.data.title} />
      </div>
    )
  }

  <div slot="header-after" class="tags">
    {post.data.tags.map((tag: string) => <span class="tag">{tag}</span>)}
  </div>

  <Content />
</ContentDetailPage>

<style>
  .header-image {
    width: 100%;
    margin-bottom: 2rem;
    border-radius: 8px;
    overflow: hidden;
  }

  .header-image img {
    width: 100%;
    height: auto;
    display: block;
  }

  .tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .tag {
    background: #f0f0f0;
    color: var(--color-gray);
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.875rem;
    font-weight: 500;
  }
</style>
